<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Pedidos - E-commerce</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 40px auto; }
    input, button { padding: 10px; width: 100%; margin: 5px 0; }
    .notificacao { padding: 10px; margin: 10px 0; background: #e0ffe0; border-left: 4px solid green; }
  </style>
</head>
<body>
  <h1>ðŸ“¦ Novo Pedido</h1>
  <form id="pedidoForm">
    <input type="text" id="cliente" placeholder="Nome do cliente" required />
    <input type="text" id="itens" placeholder="Itens separados por vÃ­rgula" required />
    <input type="number" id="valor" placeholder="Valor total" step="0.01" required />
    <button type="submit">Enviar Pedido</button>
  </form>

  <div id="notificacoes"></div>

  <script>
    // WebSocket nativo
    let ws = new WebSocket("ws://localhost:8000/ws");
    ws.onmessage = (e) => {
      const div = document.createElement("div");
      div.className = "notificacao";
      div.innerText = e.data;
      document.getElementById("notificacoes").prepend(div);
    };

    // Envio de pedido
    document.getElementById("pedidoForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const cliente = document.getElementById("cliente").value;
      const itensStr = document.getElementById("itens").value;
      const valor = document.getElementById("valor").value;

      const pedido = {
        cliente,
        itens: itensStr.split(',').map((nome, i) => ({
          id: i + 1,
          nome: nome.trim(),
          preco: parseFloat((valor / itensStr.split(',').length).toFixed(2)),
          quantidade: 1
        })),
        valorTotal: valor,
        data: new Date().toISOString()
      };

      const res = await fetch("http://localhost:8000/pedido", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(pedido)
      });

      const json = await res.json();
      alert(json.message);
    });
  </script>
</body>
</html>
